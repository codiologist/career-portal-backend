// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

////////////// 
enum Role {
  HR
  USER
  ADMIN
  MODERATOR
}

model User {
  id                    String                 @id @default(uuid())
  fullName              String?                @map("full_name")
  email                 String                 @unique
  phone                 String?                @unique
  isActive              Boolean                @default(true) @map("is_active")
  isEmailVerified       Boolean                @default(false) @map("is_email_verified")
  password              String
  role                  Role                   @default(USER)
  createdAt             DateTime               @default(now()) @map("created_at")
  candidatePersonal     CandidatePersonal? ////done 
  candidateEducations   CandidateEducation[]
  candidateExperiences  CandidateExperience[]
  candidateReferences   CandidateReference[]
  candidateLanguages    CandidateLanguage[]
  candidateAchievements CandidateAchievement[]
  addresses             Address[]
  documents             Document[]

  @@index([id, email])
  @@map("users")
}

///////////////////////////////////  CandidatePersonal ///////////////////////////////////////////

model CandidatePersonal {
  id              String    @id @default(uuid())
  careerTitle     String?   @map("career_title")
  careerObjective String?   @map("career_objective")
  dob             DateTime?
  fullName        String    @map("full_name")
  fatherName      String?   @map("father_name")
  motherName      String?   @map("mother_name")
  spouseName      String?   @map("spouse_name")
  mobileNo        String?   @map("mobile_no")
  alternatePhone  String?   @map("alternate_phone")
  gender          String
  maritalStatus   String    @map("marital_status")
  nationality     String?
  nationalId      String?   @map("national_id")
  portfolioLink   String?   @map("portfolio_link")

  photo     String?
  signature String?
  resume    String?

  religionId String?
  religion   Religion? @relation(fields: [religionId], references: [id])

  bloodGroupId String?
  bloodGroup   BloodGroup? @relation(fields: [bloodGroupId], references: [id])

  interests Interst[] @relation("CandidateInterests") // many-to-many
  skills    Skill[]   @relation("CandidateSkills") // many-to-many

  socialLink SocialLink[]

  userId String @unique @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([userId])
  @@map("candidate_personals")
}

model Religion {
  id                String              @id @default(uuid())
  name              String @unique
  candidatePersonal CandidatePersonal[]

  @@map("religions")
}

model SocialLink {
  id                  String            @id @default(uuid())
  label               String  @unique
  url                 String
  candidatePersonalId String            @map("candidate_personal_id")
  candidatePersonal   CandidatePersonal @relation(fields: [candidatePersonalId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("social_links")
}

model Interst {
  id                 String              @id @default(uuid())
  interstName        String       @unique       @map("interst_name")
  candidatesPersonal CandidatePersonal[] @relation("CandidateInterests")

  @@map("intersts")
}

model Skill {
  id                 String              @id @default(uuid())
  skillName          String           @unique   @map("skill_name")
  candidatesPersonal CandidatePersonal[] @relation("CandidateSkills")

  @@map("skills")
}

model BloodGroup {
  id                 String              @id @default(uuid())
  name               String @unique
  candidatePersonals CandidatePersonal[]

  @@map("blood_groups")
}

///////////////////////////////////  CandidatePersonal ///////////////////////////////////////////

///////////////////////////////////  CandidateEducation ///////////////////////////////////////////

model CandidateEducation {
  id     String @id @default(uuid())
  userId String @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  levelId String           @map("level_id")
  level   LevelOfEducation @relation(fields: [levelId], references: [id])

  degreeId String? @map("degree_id")
  degree   Degree? @relation(fields: [degreeId], references: [id])

  boardId String?         @map("board_id")
  board   EducationBoard? @relation(fields: [boardId], references: [id])

  subjectId String?  @map("subject_id")
  subject   Subject? @relation(fields: [subjectId], references: [id])

  resultTypeId String?     @map("result_type_id")
  resultType   ResultType? @relation(fields: [resultTypeId], references: [id])

  majorGroupId String?     @map("major_group_id")
  majorGroup   MajorGroup? @relation(fields: [majorGroupId], references: [id])

  institution String?
  passingYear Int?
  result      String?

  documents Document[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("candidate_educations")
}

model LevelOfEducation {
  id        String @id @default(uuid())
  levelName String @unique @map("level_name")

  degrees             Degree[]
  candidateEducations CandidateEducation[]

  @@map("level_of_educations")
}

model Degree {
  id         String @id @default(uuid())
  degreeName String @map("degree_name")

  levelId             String               @map("level_id")
  level               LevelOfEducation     @relation(fields: [levelId], references: [id], onDelete: Cascade)
  candidateEducations CandidateEducation[]

  @@map("degrees")
}

model EducationBoard {
  id                  String               @id @default(uuid())
  boardName           String               @unique @map("board_name")
  candidateEducations CandidateEducation[]

  @@map("education_boards")
}

model Subject {
  id                  String               @id @default(uuid())
  subjectName         String               @unique @map("subject_name")
  status              Boolean              @default(true)
  candidateEducations CandidateEducation[]

  @@map("subjects")
}

model MajorGroup {
  id                  String               @id @default(uuid())
  groupName           String               @unique @map("group_name")
  candidateEducations CandidateEducation[]

  @@map("major_groups")
}

model ResultType {
  id                  String               @id @default(uuid())
  resultType          String               @unique @map("result_type")
  candidateEducations CandidateEducation[]

  @@map("result_types")
}

///////////////////////////////////  Candidate Education ///////////////////////////////////////////

///////////////////////////////////  Candidate Exprience ///////////////////////////////////////////
model CandidateExperience {
  id                  String    @id @default(uuid())
  companyName         String    @map("company_name")
  companyBusinessType String?   @map("company_business_type")
  location            String?
  designation         String
  department          String
  isContinue          Boolean?  @default(false) @map("is_continue")
  startDate           DateTime  @map("start_date")
  endDate             DateTime? @map("end_date")
  responsibilities    String

  userId String @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime   @default(now()) @map("created_at")
  updatedAt DateTime   @updatedAt @map("updated_at")
  documents Document[]

  @@unique([userId, companyName, designation, department, companyBusinessType, responsibilities])
  @@map("candidate_experiences")
}

///////////////////////////////////  Candidate Exprience ///////////////////////////////////////////

///////////////////////////////////  Candidate References ///////////////////////////////////////////

model CandidateReference {
  id String @id @default(uuid())

  name         String
  companyName  String? @map("company_name")
  designation  String
  phone        String
  emailAddress String  @map("email_address")
  relationship String

  userId String @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("candidate_references")
}

///////////////////////////////////  Candidate References ///////////////////////////////////////////

///////////////////////////////////  Candidate Language /////////////////////////////////////////////

model CandidateLanguage {
  id          String @id @default(uuid())
  language    String
  proficiency String

  userId String @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("candidate_languages")
}

model CandidateAchievement {
  id String @id @default(uuid())

  name             String
  title            String
  organizationName String          @map("organization_name")
  url              String?
  location         String
  year             Int
  description      String

  userId    String
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  documents Document[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  @@map("candidate_achievements")
}

///////////////////////////////////  Candidate Language ///////////////////////////////////////////

///////////////////////////////////  Candidate document ///////////////////////////////////////////

model Document {
  id String @id @default(uuid())

  type                  String
  name                  String? // Certificate name or custom file name
  folderName            String?              @map("folder_name")
  documentNo            String?              @map("document_no")
  issueDate             DateTime?            @map("issue_date")
  issueAuthority        String?              @map("issue_authority")
  remarks               String?
  path                  String
  size                  Int
  mimeType              String               @map("mime_type")
  isDeleted             Boolean              @default(false) @map("is_deleted")
  createdAt             DateTime             @default(now()) @map("created_at")
  userId                String               @map("user_id")
  user                  User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  // Optional relation to a candidate experience
  candidateExperienceId String?              @map("candidate_experience_id")
  candidateExperience   CandidateExperience? @relation(fields: [candidateExperienceId], references: [id], onDelete: Cascade)

  candidateEducationId String?             @map("candidate_education_id")
  candidateEducation   CandidateEducation? @relation(fields: [candidateEducationId], references: [id], onDelete: Cascade)

  candidateAchievementId String?               @map("candidate_achievement_id")
  candidateAchievement   CandidateAchievement? @relation(fields: [candidateAchievementId], references: [id], onDelete: Cascade)

  @@unique([userId, name], name: "userId_name") // prevents duplicate certificate names per user
  @@index([userId])
  @@map("documents")
}

///////////////////////////////////  Candidate document ///////////////////////////////////////////

///////////////////////////////////  Candidate Address ///////////////////////////////////////////

model AddressType {
  id        String          @id @default(uuid())
  name      AddressTypeEnum
  addresses Address[]

  @@map("address_types")
}

enum AddressTypeEnum {
  PRESENT
  PERMANENT
}

model Address {
  id String @id @default(uuid())

  divisionId Int @map("division_id")
  districtId Int @map("district_id")

  upazilaId         Int? @map("upazila_id")
  cityCorporationId Int? @map("city_corporation_id")

  municipalityId  Int? @map("municipality_id")
  unionParishadId Int? @map("union_parishad_id")
  policeStationId Int? @map("police_station_id")
  postOfficeId    Int? @map("post_office_id")

  wardNo      String? @map("ward_no")
  addressLine String  @map("address_line")

  isSameAsPresent Boolean @default(false) @map("is_same_as_present")

  userId        String @map("user_id")
  addressTypeId String @map("address_type_id")

  user        User        @relation(fields: [userId], references: [id])
  addressType AddressType @relation(fields: [addressTypeId], references: [id])

  division        BaseDivision         @relation(fields: [divisionId], references: [id])
  district        BaseDistrict         @relation(fields: [districtId], references: [id])
  upazila         BaseUpazila?         @relation(fields: [upazilaId], references: [id])
  cityCorporation BaseCityCorporation? @relation(fields: [cityCorporationId], references: [id])
  municipality    BaseMunicipality?    @relation(fields: [municipalityId], references: [id])
  unionParishad   BaseUnionParishad?   @relation(fields: [unionParishadId], references: [id])
  policeStation   BasePoliceStation?   @relation(fields: [policeStationId], references: [id])
  postOffice      BasePostOffice?      @relation(fields: [postOfficeId], references: [id])

  @@unique([userId, addressTypeId])
  @@map("address")
}

model BaseDivision {
  id        Int       @id @default(autoincrement())
  geoCode   String    @map("geo_code")
  name      String    @db.VarChar(50)
  bnName    String    @map("bn_name") @db.VarChar(100)
  url       String    @db.VarChar(300)
  status    Boolean   @default(true)
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamp(0)
  updatedAt DateTime? @updatedAt @map("updated_at") @db.Timestamp(0)

  districts BaseDistrict[]
  addresses Address[]

  @@map("base_divisions")
}

model BaseDistrict {
  id         Int       @id @default(autoincrement())
  geoCode    String    @map("geo_code")
  divisionId Int       @map("division_id")
  name       String    @db.VarChar(50)
  bnName     String    @map("bn_name") @db.VarChar(100)
  lat        String?   @db.VarChar(50)
  lon        String?   @db.VarChar(50)
  url        String    @db.VarChar(300)
  status     Boolean   @default(true)
  createdAt  DateTime? @default(now()) @map("created_at") @db.Timestamp(0)
  updatedAt  DateTime? @updatedAt @map("updated_at") @db.Timestamp(0)

  division             BaseDivision          @relation(fields: [divisionId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  upazilas             BaseUpazila[]
  policeStations       BasePoliceStation[]
  postOffices          BasePostOffice[]
  baseCityCorporations BaseCityCorporation[]
  addresses            Address[]

  @@index([divisionId])
  @@map("base_districts")
}

model BaseCityCorporation {
  id         Int       @id @default(autoincrement())
  districtId Int       @map("district_id")
  name       String    @db.VarChar(50)
  bnName     String    @map("bn_name") @db.VarChar(100)
  status     Boolean   @default(true)
  createdAt  DateTime? @default(now()) @map("created_at") @db.Timestamp(0)
  updatedAt  DateTime? @updatedAt @map("updated_at") @db.Timestamp(0)

  district  BaseDistrict @relation(fields: [districtId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  addresses Address[]

  @@index([districtId])
  @@map("base_city_corporations")
}

model BaseUpazila {
  id         Int       @id @default(autoincrement())
  geoCode    String    @map("geo_code")
  districtId Int       @map("district_id")
  name       String    @db.VarChar(50)
  bnName     String    @map("bn_name") @db.VarChar(100)
  url        String    @db.VarChar(300)
  status     Boolean   @default(true)
  createdAt  DateTime? @default(now()) @map("created_at") @db.Timestamp(0)
  updatedAt  DateTime? @updatedAt @map("updated_at") @db.Timestamp(0)

  district       BaseDistrict        @relation(fields: [districtId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  unionParishads BaseUnionParishad[]
  postOffices    BasePostOffice[]
  municipalities BaseMunicipality[]
  addresses      Address[]

  @@index([districtId])
  @@map("base_upazilas")
}

model BasePoliceStation {
  id         Int     @id @default(autoincrement())
  geoCode    String  @map("geo_code")
  districtId Int     @map("district_id")
  name       String  @db.VarChar(75)
  bnName     String? @map("bn_name") @db.VarChar(75)
  url        String? @db.VarChar(50)
  status     Boolean @default(true)

  createdAt DateTime @default(now()) @map("created_at") @db.Timestamp(0)
  updatedAt DateTime @updatedAt @map("updated_at") @db.Timestamp(0)

  district  BaseDistrict @relation(fields: [districtId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  addresses Address[]

  @@unique([districtId, name], name: "police_stations_district_id_name_unique")
  @@index([name], name: "police_stations_name_index")
  @@map("base_police_stations")
}

model BaseUnionParishad {
  id        Int       @id @default(autoincrement())
  geoCode   String?   @map("geo_code")
  bbsCode   Int?      @map("bbs_code")
  upazilaId Int       @map("upazila_id")
  name      String    @db.VarChar(50)
  bnName    String    @map("bn_name") @db.VarChar(100)
  url       String    @db.VarChar(300)
  status    Boolean   @default(true)
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamp(0)
  updatedAt DateTime? @updatedAt @map("updated_at") @db.Timestamp(0)

  upazila   BaseUpazila @relation(fields: [upazilaId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  addresses Address[]

  @@index([upazilaId])
  @@map("base_union_parishads")
}

model BasePostOffice {
  id         Int       @id @default(autoincrement())
  districtId Int       @map("district_id")
  upazilaId  Int?      @map("upazila_id")
  postOffice String    @map("post_office") @db.VarChar(50)
  postCode   String    @map("post_code") @db.VarChar(20)
  createdAt  DateTime? @default(now()) @map("created_at") @db.Timestamp(0)
  updatedAt  DateTime? @updatedAt @map("updated_at") @db.Timestamp(0)

  district  BaseDistrict @relation(fields: [districtId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  upazila   BaseUpazila? @relation(fields: [upazilaId], references: [id], onDelete: SetNull, onUpdate: Cascade)
  addresses Address[]

  @@index([districtId])
  @@index([upazilaId])
  @@map("base_post_offices")
}

model BaseMunicipality {
  id        Int       @id @default(autoincrement())
  geoCode   String    @map("geo_code")
  upazilaId Int       @map("upazila_id")
  name      String    @db.VarChar(50)
  bnName    String    @map("bn_name") @db.VarChar(100)
  status    Boolean   @default(true)
  createdAt DateTime? @default(now()) @map("created_at") @db.Timestamp(0)
  updatedAt DateTime? @updatedAt @map("updated_at") @db.Timestamp(0)

  upazila   BaseUpazila @relation(fields: [upazilaId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  addresses Address[]

  @@index([upazilaId])
  @@map("base_municipalities")
}

////////////////////////////////////////////////////////////////////////  Candidate Address ////////////////////////////////////////////////////////////////////////
